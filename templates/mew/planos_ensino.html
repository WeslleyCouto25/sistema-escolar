<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>MEW - Planos de Ensino Gerados</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        .documentos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        .documento-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            border: 1px solid #e0e0e0;
            transition: all 0.3s;
        }
        .documento-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
        }
        .documento-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        .documento-tipo {
            background: #1e4a3b;
            color: white;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
        }
        .documento-codigo {
            font-family: monospace;
            font-size: 12px;
            color: #666;
        }
        .documento-disciplina {
            font-size: 16px;
            font-weight: bold;
            color: #1e4a3b;
            margin-bottom: 10px;
        }
        .documento-data {
            font-size: 13px;
            color: #888;
            margin-bottom: 15px;
        }
        .documento-acoes {
            display: flex;
            gap: 10px;
        }
        .btn-sm {
            padding: 8px 12px;
            font-size: 13px;
            border-radius: 5px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }
        .btn-view { background: #1e4a3b; color: white; }
        .btn-print { background: #6c757d; color: white; }
        .btn-delete { background: #dc3545; color: white; }
        .btn-validate { background: #ffc107; color: #333; }
    </style>
</head>
<body>
    <div class="topbar">
        <div class="navbar-header">
            <div class="logo-text">MEW - Planos de Ensino</div>
        </div>
        <div class="spacer"></div>
        <div class="user-menu">
            <a href="/mew/dashboard" class="logout-btn">Dashboard</a>
            <a href="/mew/logout" class="logout-btn">Sair</a>
        </div>
    </div>

    <div class="main-container">
        <nav class="sidebar">
            <div class="user-profile">
                <div class="profile-img">
                    <i class="fas fa-user-cog"></i>
                </div>
                <div class="profile-text">
                    <div class="name">Administrador MEW</div>
                    <div class="ra">Gestor</div>
                </div>
            </div>

            <div class="main-menu">
                <a href="/mew/dashboard" class="menu-item">
                    <i class="fas fa-home"></i>
                    <span class="text">Dashboard</span>
                </a>
                <a href="/mew/gerar-plano-ensino" class="menu-item">
                    <i class="fas fa-clipboard-list"></i>
                    <span class="text">Novo Plano</span>
                </a>
                <a href="/mew/planos-ensino" class="menu-item active">
                    <i class="fas fa-folder-open"></i>
                    <span class="text">Meus Planos</span>
                    <span class="badge">{{ total_planos }}</span>
                </a>
                <a href="/mew/gerenciar-documentos" class="menu-item">
                    <i class="fas fa-file-alt"></i>
                    <span class="text">Gerenciar Documentos</span>
                </a>
            </div>
        </nav>

        <main class="content-area">
            <h1 class="page-title">ðŸ“‹ Planos de Ensino Gerados</h1>
            <p class="page-subtitle">Total de {{ total_planos }} planos gerados</p>

            <div style="margin: 20px 0;">
                <a href="/mew/gerar-plano-ensino" class="btn" style="background: #1e4a3b; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none;">
                    <i class="fas fa-plus"></i> Gerar Novo Plano
                </a>
            </div>

            {% if planos %}
            <div class="documentos-grid">
                {% for plano in planos %}
                <div class="documento-card">
                    <div class="documento-header">
                        <span class="documento-tipo">
                            {% if plano.tipo == 'plano_ensino' %}ðŸ“‹ Plano de Ensino{% else %}ðŸ“„ {{ plano.tipo }}{% endif %}
                        </span>
                        <span class="documento-codigo">{{ plano.codigo[:12] }}...</span>
                    </div>
                    <div class="documento-disciplina">
                        {% set conteudo = plano.conteudo_html %}
                        {% set start = conteudo.find('<strong>') + 8 if '<strong>' in conteudo else -1 %}
                        {% set end = conteudo.find('</strong>', start) if start > -1 else -1 %}
                        {% if start > -1 and end > -1 %}
                            {{ conteudo[start:end] }}
                        {% else %}
                            Plano de Ensino
                        {% endif %}
                    </div>
                    <div class="documento-data">
                        <i class="far fa-calendar-alt"></i> {{ plano.data_geracao }}
                    </div>
                    <div class="documento-acoes">
                        <a href="/ver-documento/{{ plano.codigo }}" class="btn-sm btn-view" target="_blank">
                            <i class="fas fa-eye"></i> Visualizar
                        </a>
                        <a href="/validar-documento/{{ plano.codigo }}" class="btn-sm btn-validate" target="_blank">
                            <i class="fas fa-qrcode"></i> Validar
                        </a>
                        <a href="#" onclick="imprimirDocumento('{{ plano.codigo }}')" class="btn-sm btn-print">
                            <i class="fas fa-print"></i>
                        </a>
                        <a href="/mew/deletar-documento/{{ plano.codigo }}" class="btn-sm btn-delete" onclick="return confirm('Tem certeza que deseja excluir este plano?')">
                            <i class="fas fa-trash"></i>
                        </a>
                    </div>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <div style="text-align: center; padding: 50px; background: white; border-radius: 10px;">
                <i class="fas fa-folder-open" style="font-size: 48px; color: #ccc;"></i>
                <p style="margin-top: 20px; color: #666;">Nenhum plano de ensino gerado ainda.</p>
                <a href="/mew/gerar-plano-ensino" class="btn" style="display: inline-block; margin-top: 20px; background: #1e4a3b; color: white; padding: 10px 20px; border-radius: 5px; text-decoration: none;">
                    <i class="fas fa-plus"></i> Gerar Primeiro Plano
                </a>
            </div>
            {% endif %}
        </main>
    </div>

    <script>
        function imprimirDocumento(codigo) {
            const url = `/ver-documento/${codigo}`;
            const printWindow = window.open(url, '_blank');
            printWindow.onload = function() {
                printWindow.print();
            };
        }
    </script>
</body>
</html>