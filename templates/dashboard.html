<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5, user-scalable=yes">
    <title>Dashboard do Aluno | FACOP SiGEU</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <style>
        /* ===== VARI√ÅVEIS GLOBAIS ===== */
        :root {
            --primary: #0a2c4e;
            --primary-light: #1e3a5f;
            --primary-dark: #051e33;
            --secondary: #b8860b;
            --secondary-light: #daa520;
            --accent: #8b0000;
            --success: #2e7d32;
            --warning: #ed6c02;
            --info: #0288d1;
            --gray-50: #f8fafc;
            --gray-100: #f1f5f9;
            --gray-200: #e2e8f0;
            --gray-300: #cbd5e1;
            --gray-400: #94a3b8;
            --gray-500: #64748b;
            --gray-600: #475569;
            --gray-700: #334155;
            --gray-800: #1e293b;
            --gray-900: #0f172a;
            --shadow-sm: 0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24);
            --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1), 0 2px 4px -1px rgba(0,0,0,0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1), 0 4px 6px -2px rgba(0,0,0,0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1), 0 10px 10px -5px rgba(0,0,0,0.04);
            --radius-sm: 6px;
            --radius-md: 10px;
            --radius-lg: 16px;
            --radius-xl: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--gray-100);
            color: var(--gray-800);
            line-height: 1.5;
            -webkit-font-smoothing: antialiased;
        }

        /* ===== TOPBAR ===== */
        .topbar {
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-dark) 100%);
            height: 70px;
            display: flex;
            align-items: center;
            padding: 0 24px;
            color: white;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .navbar-header {
            display: flex;
            align-items: center;
        }

        .logo-text {
            font-weight: 600;
            font-size: 1.25rem;
            letter-spacing: 0.5px;
            background: rgba(255,255,255,0.1);
            padding: 8px 16px;
            border-radius: 40px;
            border: 1px solid rgba(255,255,255,0.2);
        }

        .spacer {
            flex: 1;
        }

        .user-menu {
            display: flex;
            gap: 12px;
        }

        .logout-btn {
            color: white;
            text-decoration: none;
            padding: 8px 16px;
            border-radius: 40px;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255,255,255,0.1);
        }

        .logout-btn:hover {
            background: rgba(255,255,255,0.2);
            transform: translateY(-1px);
        }

        .logout-btn.active {
            background: var(--secondary);
            color: var(--primary-dark);
            font-weight: 600;
        }

        /* ===== MAIN CONTAINER ===== */
        .main-container {
            display: flex;
            min-height: calc(100vh - 70px);
        }

        /* ===== SIDEBAR ===== */
        .sidebar {
            width: 280px;
            background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
            color: white;
            overflow-y: auto;
            transition: all 0.3s;
            box-shadow: var(--shadow-lg);
        }

        .user-profile {
            padding: 30px 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .profile-img {
            width: 80px;
            height: 80px;
            margin: 0 auto 15px;
            background: rgba(255,255,255,0.15);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 3px solid var(--secondary);
        }

        .profile-img i {
            font-size: 40px;
            color: white;
        }

        .profile-text .name {
            font-weight: 600;
            font-size: 1.1rem;
            margin-bottom: 5px;
        }

        .profile-text .ra {
            font-size: 0.9rem;
            opacity: 0.8;
            background: rgba(255,255,255,0.15);
            padding: 4px 12px;
            border-radius: 20px;
            display: inline-block;
        }

        .dashboard-menu-header {
            padding: 20px 20px 10px;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            font-weight: 600;
        }

        .section-menu {
            list-style: none;
            padding: 0;
            margin: 0 0 20px;
        }

        .section-menu-item {
            padding: 12px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: all 0.2s;
            margin: 2px 8px;
            border-radius: var(--radius-md);
            font-weight: 500;
        }

        .section-menu-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .section-menu-item.active {
            background: rgba(255,255,255,0.15);
            border-left: 4px solid var(--secondary);
            font-weight: 600;
        }

        .section-menu-item i {
            width: 24px;
            text-align: center;
            font-size: 1.2rem;
        }

        .badge-menu {
            background: var(--secondary);
            color: var(--primary-dark);
            padding: 2px 8px;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-left: auto;
        }

        .main-menu {
            margin-top: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
        }

        .menu-section {
            padding: 20px 20px 10px;
            font-size: 0.85rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0.7;
            font-weight: 600;
        }

        .menu-item {
            display: flex;
            align-items: center;
            padding: 10px 20px;
            color: white;
            text-decoration: none;
            gap: 12px;
            margin: 2px 8px;
            border-radius: var(--radius-md);
            transition: all 0.2s;
            font-weight: 500;
        }

        .menu-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .menu-item i {
            width: 24px;
            text-align: center;
        }

        /* ===== CONTENT AREA ===== */
        .content-area {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            background: var(--gray-100);
        }

        .content-section {
            display: none;
            animation: fadeIn 0.3s ease;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .page-title {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            margin-bottom: 8px;
            letter-spacing: -0.5px;
        }

        .page-subtitle {
            font-size: 1rem;
            color: var(--gray-600);
            margin-bottom: 30px;
            border-left: 4px solid var(--secondary);
            padding-left: 16px;
        }

        /* ===== CARDS GRID ===== */
        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
            margin-top: 20px;
        }

        .info-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        /* ===== CARD STYLES ===== */
        .card {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            overflow: hidden;
            transition: all 0.3s;
            border: 1px solid var(--gray-200);
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
            border-color: var(--secondary-light);
        }

        .card-header {
            padding: 20px;
            position: relative;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
        }

        .card-header.concluido {
            background: linear-gradient(135deg, var(--success) 0%, #1b5e20 100%);
        }

        .card-header h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            padding-right: 80px;
        }

        .status-badge {
            position: absolute;
            top: 16px;
            right: 16px;
            padding: 4px 12px;
            border-radius: 40px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            background: rgba(255,255,255,0.2);
            backdrop-filter: blur(4px);
        }

        .card-content {
            padding: 20px;
        }

        .course-name {
            font-weight: 600;
            color: var(--gray-800);
            margin-bottom: 15px;
            font-size: 1rem;
        }

        .progress-container {
            margin: 15px 0;
        }

        .progress-bar {
            height: 8px;
            background: var(--gray-200);
            border-radius: 20px;
            overflow: hidden;
            margin: 8px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
            border-radius: 20px;
            transition: width 0.5s;
        }

        .card-actions {
            margin-top: 20px;
            display: flex;
            gap: 12px;
        }

        /* ===== BUTTONS ===== */
        .btn {
            padding: 10px 20px;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--primary);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: white;
            color: var(--primary);
            border: 2px solid var(--primary);
        }

        .btn-secondary:hover {
            background: var(--gray-50);
            transform: translateY(-2px);
        }

        .btn-success {
            background: var(--success);
            color: white;
        }

        /* ===== INFO CARDS ===== */
        .info-card {
            background: white;
            padding: 24px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            text-align: center;
            border: 1px solid var(--gray-200);
            transition: all 0.2s;
        }

        .info-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            border-color: var(--secondary);
        }

        .info-card h4 {
            color: var(--gray-600);
            margin-bottom: 12px;
            font-size: 1rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .info-card h4 i {
            color: var(--secondary);
        }

        .info-card p {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
            line-height: 1.2;
        }

        /* ===== DISCIPLINA NOTAS ===== */
        .disciplina-notas {
            background: white;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid var(--gray-200);
        }

        .disciplina-notas-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .disciplina-notas-header:hover {
            background: var(--gray-50);
        }

        .disciplina-notas-content {
            display: none;
            margin-top: 20px;
            padding-top: 20px;
            border-top: 2px solid var(--gray-200);
        }

        .disciplina-notas-content.show {
            display: block;
        }

        .notas-summary {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin-bottom: 20px;
        }

        .summary-item {
            text-align: center;
            padding: 15px;
            background: var(--gray-50);
            border-radius: var(--radius-md);
        }

        .nota-item {
            background: var(--gray-50);
            padding: 15px;
            border-radius: var(--radius-md);
            margin-bottom: 10px;
            border-left: 4px solid var(--primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .nota-valor {
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* ===== DADOS ALUNO CARD ===== */
        .dados-aluno-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 30px;
        }

        .dados-aluno-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }

        .dado-item {
            padding: 20px;
            background: var(--gray-50);
            border-radius: var(--radius-md);
            transition: all 0.2s;
        }

        .dado-item:hover {
            background: white;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--secondary);
        }

        .dado-label {
            font-size: 0.9rem;
            color: var(--gray-500);
            margin-bottom: 8px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .dado-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--gray-800);
        }

        /* ===== BADGES ===== */
        .badge-success {
            background: #e8f5e9;
            color: var(--success);
            padding: 4px 12px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .badge-warning {
            background: #fff3e0;
            color: var(--warning);
            padding: 4px 12px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        .badge-secondary {
            background: var(--gray-200);
            color: var(--gray-700);
            padding: 4px 12px;
            border-radius: 40px;
            font-weight: 600;
            font-size: 0.85rem;
        }

        /* ===== DOCUMENTOS ===== */
        .documentos-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 24px;
        }

        .documento-card {
            background: white;
            border-radius: var(--radius-lg);
            padding: 24px;
            box-shadow: var(--shadow-sm);
            border-left: 4px solid var(--primary);
            transition: all 0.3s;
        }

        .documento-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--shadow-lg);
        }

        .documento-card.novo {
            border-left-color: var(--secondary);
            background: #fff9e6;
        }

        .documento-card.visualizado {
            border-left-color: var(--success);
        }

        .documento-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .documento-header i {
            font-size: 2rem;
            color: var(--primary);
        }

        .documento-header .status {
            padding: 4px 12px;
            border-radius: 40px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .documento-card.novo .status {
            background: var(--secondary);
            color: white;
        }

        .documento-card.visualizado .status {
            background: var(--success);
            color: white;
        }

        .documento-card h4 {
            font-size: 1.1rem;
            color: var(--gray-800);
            margin-bottom: 8px;
            font-weight: 600;
        }

        .documento-card .data {
            font-size: 0.9rem;
            color: var(--gray-500);
            margin-bottom: 12px;
        }

        .documento-card .mensagem {
            background: var(--gray-50);
            padding: 15px;
            border-radius: var(--radius-md);
            font-size: 0.95rem;
            color: var(--gray-700);
            margin: 15px 0;
            border-left: 3px solid var(--secondary);
        }

        .btn-view {
            display: inline-block;
            padding: 10px 20px;
            background: var(--primary);
            color: white;
            text-decoration: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            font-size: 0.95rem;
            transition: all 0.2s;
            width: 100%;
            text-align: center;
        }

        .btn-view:hover {
            background: var(--primary-light);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* ===== EMPTY STATES ===== */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: var(--radius-lg);
            border: 2px dashed var(--gray-300);
        }

        .empty-state i {
            font-size: 4rem;
            color: var(--gray-400);
            margin-bottom: 20px;
        }

        .empty-state h3 {
            font-size: 1.5rem;
            color: var(--gray-700);
            margin-bottom: 10px;
        }

        .empty-state p {
            color: var(--gray-500);
            margin-bottom: 25px;
        }

        /* ===== TABLES ===== */
        .requests-table {
            width: 100%;
            border-collapse: collapse;
        }

        .requests-table th {
            text-align: left;
            padding: 15px;
            background: var(--gray-100);
            color: var(--gray-700);
            font-weight: 600;
            font-size: 0.9rem;
        }

        .requests-table td {
            padding: 15px;
            border-bottom: 1px solid var(--gray-200);
        }

        .requests-table tr:hover {
            background: var(--gray-50);
        }

        /* ===== MODAL ===== */
        #modalDisciplinas {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.6);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            backdrop-filter: blur(4px);
        }

        #modalDisciplinas > div {
            background: white;
            border-radius: var(--radius-lg);
            width: 90%;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: var(--shadow-xl);
        }

        /* ===== RESPONSIVIDADE ===== */
        @media (max-width: 1024px) {
            .sidebar {
                width: 240px;
            }
            
            .content-area {
                padding: 20px;
            }
        }

        @media (max-width: 768px) {
            .topbar {
                padding: 0 16px;
            }
            
            .logo-text {
                font-size: 1rem;
                padding: 6px 12px;
            }
            
            .logout-btn span {
                display: none;
            }
            
            .logout-btn i {
                margin: 0;
            }
            
            .main-container {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                max-height: 300px;
                overflow-y: auto;
            }
            
            .user-profile {
                padding: 20px;
            }
            
            .profile-img {
                width: 60px;
                height: 60px;
            }
            
            .profile-img i {
                font-size: 30px;
            }
            
            .section-menu {
                display: flex;
                flex-wrap: wrap;
                padding: 10px;
            }
            
            .section-menu-item {
                flex: 1 1 auto;
                min-width: 120px;
                margin: 2px;
                padding: 10px;
                justify-content: center;
            }
            
            .section-menu-item span {
                font-size: 0.9rem;
            }
            
            .main-menu {
                display: none;
            }
            
            .content-area {
                padding: 16px;
            }
            
            .page-title {
                font-size: 1.5rem;
            }
            
            .info-grid {
                grid-template-columns: 1fr;
            }
            
            .cards-container {
                grid-template-columns: 1fr;
            }
            
            .notas-summary {
                grid-template-columns: 1fr;
            }
            
            .documentos-grid {
                grid-template-columns: 1fr;
            }
            
            .dados-aluno-grid {
                grid-template-columns: 1fr;
            }
            
            .requests-table {
                display: block;
                overflow-x: auto;
            }
        }

        @media (max-width: 480px) {
            .section-menu-item {
                min-width: 100%;
            }
            
            .section-menu-item span {
                font-size: 0.85rem;
            }
            
            .card-header h3 {
                font-size: 1rem;
            }
            
            .info-card p {
                font-size: 1.5rem;
            }
        }

        /* ===== UTILITIES ===== */
        .text-center { text-align: center; }
        .mt-4 { margin-top: 24px; }
        .mb-4 { margin-bottom: 24px; }
        .w-100 { width: 100%; }
    </style>
</head>

<body>
    <!-- Top Bar -->
    <header class="topbar">
        <div class="navbar-header">
            <div class="logo-text">FACOP ‚Ä¢ SiGEU</div>
        </div>
        <div class="spacer"></div>
        <div class="user-menu">
            <a href="/dashboard" class="logout-btn active">
                <i class="fas fa-graduation-cap"></i>
                <span>Dashboard</span>
            </a>
            <a href="/logout" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i>
                <span>Sair</span>
            </a>
        </div>
    </header>

    <div class="main-container">
        <nav class="sidebar">
            <div class="user-profile">
                <div class="profile-img">
                    <i class="fas fa-user-graduate"></i>
                </div>
                <div class="profile-text">
                    <div class="name">{{ aluno_nome }}</div>
                    <div class="ra">RA: {{ aluno_ra }}</div>
                </div>
            </div>

            <div class="dashboard-menu-header">
                <i class="fas fa-bars"></i> Menu do Dashboard
            </div>
            <ul class="section-menu">
                <li class="section-menu-item active" data-section="dashboard">
                    <i class="fas fa-home"></i>
                    <span>Vis√£o Geral</span>
                </li>
                <li class="section-menu-item" data-section="disciplinas">
                    <i class="fas fa-book"></i>
                    <span>Minhas Disciplinas</span>
                </li>
                <li class="section-menu-item" data-section="notas">
                    <i class="fas fa-chart-line"></i>
                    <span>Minhas Notas</span>
                </li>
                
                <li class="section-menu-item" data-section="meus-documentos">
                    <i class="fas fa-file-alt"></i>
                    <span>Meus Documentos</span>
                    {% if nao_visualizados and nao_visualizados > 0 %}
                    <span class="badge-menu">{{ nao_visualizados }}</span>
                    {% endif %}
                </li>
                
                <li class="section-menu-item" data-section="dados-pessoais">
                    <i class="fas fa-user"></i>
                    <span>Meus Dados Pessoais</span>
                </li>
                <li class="section-menu-item" data-section="financeiro">
                    <i class="fas fa-credit-card"></i>
                    <span>Situa√ß√£o Financeira</span>
                </li>
                <li class="section-menu-item" data-section="situacao-academica">
                    <i class="fas fa-chart-bar"></i>
                    <span>Situa√ß√£o Acad√™mica</span>
                </li>
                <li class="section-menu-item" data-section="avaliacao-final">
                    <i class="fas fa-file-signature"></i>
                    <span>Avalia√ß√£o Final</span>
                </li>
                <li class="section-menu-item" data-section="solicitar-documentos">
                    <i class="fas fa-file-contract"></i>
                    <span>Solicitar Documentos</span>
                </li>
                
                {% if solicitacoes_material or solicitacoes_declaracoes %}
                <li class="section-menu-item" data-section="solicitacoes">
                    <i class="fas fa-clipboard-list"></i>
                    <span>Minhas Solicita√ß√µes</span>
                </li>
                {% endif %}
            </ul>

            <div class="main-menu">
                <div class="menu-section">Acesso R√°pido</div>
                {% for d in disciplinas %}
                <a href="/disciplina/{{ d['id'] }}" class="menu-item">
                    <i class="fas fa-book"></i>
                    <span class="text">{{ d['nome'][:20] }}{% if d['nome']|length > 20 %}...{% endif %}</span>
                </a>
                {% endfor %}
            </div>
        </nav>

        <main class="content-area">
            <!-- SE√á√ÉO: DASHBOARD -->
            <div class="content-section active" id="dashboard-section">
                <h1 class="page-title">üìä Vis√£o Geral</h1>
                <p class="page-subtitle">Bem-vindo(a), {{ aluno_nome }}</p>

                <div class="info-grid">
                    <div class="info-card">
                        <h4><i class="fas fa-book"></i> Disciplinas</h4>
                        <p>{{ disciplinas|length }}</p>
                    </div>
                    <div class="info-card">
                        <h4><i class="fas fa-chart-line"></i> M√©dia Geral</h4>
                        <p>{{ media_geral }}/10</p>
                    </div>
                    <div class="info-card">
                        <h4><i class="fas fa-clipboard-check"></i> Provas</h4>
                        <p>{{ total_provas_realizadas }}</p>
                    </div>
                    <div class="info-card">
                        <h4><i class="fas fa-percentage"></i> Progresso M√©dio</h4>
                        <p>{% if disciplinas %}{{ (progressos|sum / disciplinas|length if disciplinas|length > 0 else 0)|round|int }}%{% else %}0%{% endif %}</p>
                    </div>
                    <div class="info-card" onclick="showSection('meus-documentos')" style="cursor: pointer;">
                        <h4><i class="fas fa-file-alt"></i> Documentos</h4>
                        <p>{% if nao_visualizados and nao_visualizados > 0 %}{{ nao_visualizados }} novo(s){% else %}0{% endif %}</p>
                    </div>
                </div>

                <h2 class="section-title">üë§ Meus Dados</h2>
                <div class="dados-aluno-card">
                    <div class="dados-aluno-grid">
                        <div class="dado-item">
                            <div class="dado-label">Nome Completo</div>
                            <div class="dado-value">{{ aluno_nome }}</div>
                        </div>
                        <div class="dado-item">
                            <div class="dado-label">RA</div>
                            <div class="dado-value">{{ aluno_ra }}</div>
                        </div>
                        <div class="dado-item">
                            <div class="dado-label">Email</div>
                            <div class="dado-value">{{ aluno_email }}</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- SE√á√ÉO: MEUS DOCUMENTOS -->
            <div class="content-section" id="meus-documentos-section">
                <h1 class="page-title">üìÑ Meus Documentos</h1>
                <p class="page-subtitle">Documentos oficiais enviados pela institui√ß√£o</p>

                <div class="card" id="documentos-recebidos">
                    <div style="text-align: center; padding: 30px;">
                        <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: var(--primary);"></i>
                        <p>Carregando documentos...</p>
                    </div>
                </div>
            </div>

            <!-- SE√á√ÉO: AVALIA√á√ÉO FINAL -->
            <div class="content-section" id="avaliacao-final-section">
                <div class="empty-state">
                    <i class="fas fa-file-signature"></i>
                    <h2>Avalia√ß√£o Final Disciplinar</h2>
                    <p>Para acessar a avalia√ß√£o final, clique no bot√£o abaixo:</p>
                    <a href="/avaliacao-final" class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i> Acessar Avalia√ß√£o Final
                    </a>
                </div>
            </div>

            <!-- SE√á√ÉO: DISCIPLINAS -->
            <div class="content-section" id="disciplinas-section">
                <h1 class="page-title">üìö Minhas Disciplinas</h1>
                <p class="page-subtitle">Acompanhe seu progresso</p>

                {% if disciplinas %}
                <div class="cards-container">
                    {% for d in disciplinas %}
                    {% set progresso = calcular_progresso(session.get('aluno_id'), d['id']) %}
                    {% set total_capitulos = contar_capitulos(d['id']) %}
                    {% set provas_feitas = contar_provas_realizadas(session.get('aluno_id'), d['id']) %}

                    <div class="card">
                        <div class="card-header {% if progresso == 100 %}concluido{% endif %}">
                            <h3><i class="fas fa-book"></i> {{ d['nome'][:40] }}{% if d['nome']|length > 40 %}...{% endif %}</h3>
                            <div class="status-badge">
                                {% if progresso == 100 %}Conclu√≠do{% else %}Cursando{% endif %}
                            </div>
                        </div>
                        <div class="card-content">
                            <div class="course-name">{{ d['nome'] }}</div>
                            <div class="progress-container">
                                <div style="display: flex; justify-content: space-between;">
                                    <span>Progresso:</span>
                                    <strong>{{ progresso }}%</strong>
                                </div>
                                <div class="progress-bar">
                                    <div class="progress-fill" style="width: {{ progresso }}%;"></div>
                                </div>
                            </div>
                            <div style="font-size: 0.9rem; color: var(--gray-600);">
                                <i class="fas fa-layer-group"></i> Cap√≠tulos: {{ total_capitulos }}<br>
                                <i class="fas fa-clipboard-check"></i> Provas: {{ provas_feitas }}/{{ total_capitulos }}
                            </div>
                            <div class="card-actions">
                                <a href="/disciplina/{{ d['id'] }}" class="btn btn-primary w-100">
                                    <i class="fas fa-play-circle"></i> Acessar
                                </a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-book"></i>
                    <h3>Nenhuma disciplina matriculada</h3>
                    <p>Entre em contato com a administra√ß√£o.</p>
                </div>
                {% endif %}
            </div>

            <!-- SE√á√ÉO: NOTAS (mantida exatamente igual, apenas com classes CSS atualizadas) -->
            <div class="content-section" id="notas-section">
                <h1 class="page-title">üìä Minhas Notas</h1>
                <p class="page-subtitle">Acompanhe seu desempenho</p>

                {% if notas %}
                <div class="card">
                    <div class="info-grid">
                        <div class="info-card">
                            <h4><i class="fas fa-chart-line"></i> M√©dia Geral</h4>
                            <p>{{ media_geral }}/10</p>
                        </div>
                        <div class="info-card">
                            <h4><i class="fas fa-clipboard-check"></i> Provas</h4>
                            <p>{{ total_provas_realizadas }}</p>
                        </div>
                        <div class="info-card">
                            <h4><i class="fas fa-book"></i> Material</h4>
                            <p>{{ material_pendente }}</p>
                        </div>
                        <div class="info-card">
                            <h4><i class="fas fa-file-alt"></i> Declara√ß√µes</h4>
                            <p>{{ declaracoes_pendentes }}</p>
                        </div>
                    </div>

                    <div style="margin-top: 40px;">
                        <h4 style="color: var(--gray-800); margin-bottom: 20px;">üìù Detalhes por Disciplina</h4>

                        {% set notas_por_disciplina = {} %}
                        {% for nota in notas %}
                        {% if nota['disciplina_id'] not in notas_por_disciplina %}
                        {% set _ = notas_por_disciplina.update({nota['disciplina_id']: []}) %}
                        {% endif %}
                        {% set _ = notas_por_disciplina[nota['disciplina_id']].append(nota) %}
                        {% endfor %}

                        {% if notas_por_disciplina %}
                        {% for disciplina_id, notas_disciplina in notas_por_disciplina.items() %}
                        {% set disciplina_info = namespace(nome='', media=0, total_capitulos=0) %}
                        {% for d in disciplinas %}
                        {% if d['id'] == disciplina_id %}
                        {% set disciplina_info.nome = d['nome'] %}
                        {% set disciplina_info.total_capitulos = contar_capitulos(d['id']) %}
                        {% endif %}
                        {% endfor %}

                        {% set soma_notas = 0 %}
                        {% for nota in notas_disciplina %}
                        {% set soma_notas = soma_notas + nota['nota'] %}
                        {% endfor %}
                        {% set disciplina_info.media = (soma_notas / notas_disciplina|length) if notas_disciplina|length > 0 else 0 %}

                        <div class="disciplina-notas">
                            <div class="disciplina-notas-header" onclick="toggleDisciplinaNotas('{{ disciplina_id }}')">
                                <div style="display: flex; align-items: center; gap: 10px;">
                                    <i class="fas fa-book" style="color: var(--primary);"></i>
                                    <div>
                                        <strong>{{ disciplina_info.nome }}</strong>
                                        <div style="font-size: 0.9rem; color: var(--gray-600);">
                                            {{ notas_disciplina|length }}/{{ disciplina_info.total_capitulos }} cap√≠tulos
                                        </div>
                                    </div>
                                </div>
                                <div style="display: flex; align-items: center; gap: 15px;">
                                    <div style="text-align: right;">
                                        <div style="font-size: 1.5rem; font-weight: bold; color: var(--primary);">
                                            {{ "%.1f"|format(disciplina_info.media) }}/10
                                        </div>
                                    </div>
                                    <i class="fas fa-chevron-down expand-icon" id="icon-{{ disciplina_id }}"></i>
                                </div>
                            </div>

                            <div class="disciplina-notas-content" id="notas-{{ disciplina_id }}">
                                <div class="notas-summary">
                                    <div class="summary-item">
                                        <div style="font-size: 0.9rem; color: var(--gray-600);">Cap√≠tulos</div>
                                        <div style="font-size: 1.5rem; font-weight: bold;">{{ notas_disciplina|length }}</div>
                                    </div>
                                    <div class="summary-item">
                                        <div style="font-size: 0.9rem; color: var(--gray-600);">M√©dia</div>
                                        <div style="font-size: 1.5rem; font-weight: bold;">{{ "%.1f"|format(disciplina_info.media) }}</div>
                                    </div>
                                    <div class="summary-item">
                                        <div style="font-size: 0.9rem; color: var(--gray-600);">Progresso</div>
                                        <div style="font-size: 1.5rem; font-weight: bold;">{{ ((notas_disciplina|length / disciplina_info.total_capitulos) * 100)|round|int }}%</div>
                                    </div>
                                </div>

                                {% for nota in notas_disciplina %}
                                <div class="nota-item">
                                    <div>
                                        <strong>Cap√≠tulo {{ nota['capitulo'] }}</strong>
                                    </div>
                                    <div style="display: flex; align-items: center; gap: 15px;">
                                        <span class="nota-valor" style="color: {% if nota['nota'] >= 7 %}var(--success){% elif nota['nota'] >= 5 %}var(--warning){% else %}var(--accent){% endif %};">
                                            {{ nota['nota'] }}/10
                                        </span>
                                        <span>{% if nota['nota'] >= 7 %}‚úÖ{% elif nota['nota'] >= 5 %}‚ö†Ô∏è{% else %}‚ùå{% endif %}</span>
                                    </div>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                        {% endfor %}
                        {% else %}
                        <div class="empty-notas">
                            <p>Nenhuma nota registrada.</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% else %}
                <div class="empty-state">
                    <i class="fas fa-clipboard-list"></i>
                    <h3>Nenhuma nota registrada</h3>
                    <p>Voc√™ ainda n√£o realizou nenhuma prova.</p>
                    <a href="/dashboard" class="btn btn-primary">Come√ßar uma Disciplina</a>
                </div>
                {% endif %}
            </div>

            <!-- SE√á√ÉO: DADOS PESSOAIS (mantida, apenas classes atualizadas) -->
            <div class="content-section" id="dados-pessoais-section">
                <h1 class="page-title">üë§ Meus Dados Pessoais</h1>
                <p class="page-subtitle">Informa√ß√µes cadastrais</p>
                <div class="card">
                    <div class="dados-aluno-card">
                        <div class="dados-aluno-grid">
                            <!-- ... todo o conte√∫do existente mantido exatamente igual ... -->
                            {% if dados_pessoais %}
                            <div class="dado-item">
                                <div class="dado-label">Nome Completo</div>
                                <div class="dado-value">{{ aluno_nome }}</div>
                            </div>
                            <div class="dado-item">
                                <div class="dado-label">RA</div>
                                <div class="dado-value">{{ aluno_ra }}</div>
                            </div>
                            <div class="dado-item">
                                <div class="dado-label">Email</div>
                                <div class="dado-value">{{ aluno_email }}</div>
                            </div>
                            <div class="dado-item">
                                <div class="dado-label">CPF</div>
                                <div class="dado-value">{{ dados_pessoais['cpf'] or 'N√£o informado' }}</div>
                            </div>
                            <div class="dado-item">
                                <div class="dado-label">RG</div>
                                <div class="dado-value">{{ dados_pessoais['rg'] or 'N√£o informado' }}</div>
                            </div>
                            <div class="dado-item">
                                <div class="dado-label">Telefone</div>
                                <div class="dado-value">{{ dados_pessoais['telefone'] or 'N√£o informado' }}</div>
                            </div>
                            <div class="dado-item">
                                <div class="dado-label">Endere√ßo</div>
                                <div class="dado-value">{{ dados_pessoais['endereco'] or 'N√£o informado' }}</div>
                            </div>
                            <div class="dado-item">
                                <div class="dado-label">Cidade</div>
                                <div class="dado-value">{{ dados_pessoais['cidade'] or 'N√£o informado' }}/{{ dados_pessoais['estado'] or '' }}</div>
                            </div>
                            <div class="dado-item">
                                <div class="dado-label">CEP</div>
                                <div class="dado-value">{{ dados_pessoais['cep'] or 'N√£o informado' }}</div>
                            </div>
                            <div class="dado-item">
                                <div class="dado-label">Curso</div>
                                <div class="dado-value">{{ dados_pessoais['curso_referencia'] or 'N√£o informado' }}</div>
                            </div>
                            {% else %}
                            <div class="dado-item" style="grid-column: 1 / -1; text-align: center;">
                                <i class="fas fa-exclamation-triangle" style="font-size: 48px; color: var(--warning);"></i>
                                <h3>Dados n√£o cadastrados</h3>
                                <p>Entre em contato com a administra√ß√£o.</p>
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- SE√á√ÉO: FINANCEIRO (mantida) -->
            <div class="content-section" id="financeiro-section">
                <h1 class="page-title">üí∞ Situa√ß√£o Financeira</h1>
                <p class="page-subtitle">Informa√ß√µes de pagamento</p>
                <div class="card">
                    {% if situacao_financeira %}
                    <div class="dados-aluno-card">
                        <div class="dados-aluno-grid">
                            <!-- ... todo o conte√∫do existente mantido ... -->
                            <div class="dado-item">
                                <div class="dado-label">Forma de Pagamento</div>
                                <div class="dado-value">
                                    {% if situacao_financeira['forma_pagamento'] == 'avista' %}√Ä Vista
                                    {% elif situacao_financeira['forma_pagamento'] == 'cartao' %}Cart√£o
                                    {% elif situacao_financeira['forma_pagamento'] == 'boleto_pix' %}Boleto/PIX
                                    {% else %}{{ situacao_financeira['forma_pagamento'] }}{% endif %}
                                </div>
                            </div>
                            <div class="dado-item">
                                <div class="dado-label">Status</div>
                                <div class="dado-value">
                                    {% if situacao_financeira['status'] == 'pago' %}
                                    <span class="badge-success">Pago</span>
                                    {% elif situacao_financeira['status'] == 'pendente' %}
                                    <span class="badge-warning">Pendente</span>
                                    {% elif situacao_financeira['status'] == 'parcial' %}
                                    <span class="badge-secondary">Parcial</span>
                                    {% else %}<span>{{ situacao_financeira['status'] }}</span>{% endif %}
                                </div>
                            </div>
                            <div class="dado-item">
                                <div class="dado-label">Parcelas</div>
                                <div class="dado-value">{{ situacao_financeira['parcelas_pagas'] }}/{{ situacao_financeira['parcelas_total'] }}</div>
                            </div>
                            <div class="dado-item">
                                <div class="dado-label">Valor Total</div>
                                <div class="dado-value">R$ {{ "%.2f"|format(situacao_financeira['valor_total']|float) if situacao_financeira['valor_total'] else '0,00' }}</div>
                            </div>
                        </div>
                        <div style="margin-top: 30px;">
                            <h4>Progresso</h4>
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: {{ (situacao_financeira['parcelas_pagas'] / situacao_financeira['parcelas_total'] * 100) }}%;"></div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="empty-state">
                        <i class="fas fa-credit-card"></i>
                        <h3>Informa√ß√µes n√£o dispon√≠veis</h3>
                        <p>Entre em contato com a administra√ß√£o.</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <!-- SE√á√ÉO: SOLICITA√á√ïES (mantida) -->
            {% if solicitacoes_material or solicitacoes_declaracoes %}
            <div class="content-section" id="solicitacoes-section">
                <h1 class="page-title">üìã Minhas Solicita√ß√µes</h1>
                <p class="page-subtitle">Acompanhe seus pedidos</p>
                <div class="card">
                    <!-- ... conte√∫do existente mantido ... -->
                </div>
            </div>
            {% endif %}

            <!-- SE√á√ÉO: SITUA√á√ÉO ACAD√äMICA (mantida) -->
            <div class="content-section" id="situacao-academica-section">
                <div class="empty-state">
                    <i class="fas fa-chart-bar"></i>
                    <h2>Situa√ß√£o Acad√™mica</h2>
                    <p>Visualize seu desempenho completo</p>
                    <a href="/situacao-academica" class="btn btn-primary">
                        <i class="fas fa-external-link-alt"></i> Acessar
                    </a>
                </div>
            </div>

            <!-- SE√á√ÉO: SOLICITAR DOCUMENTOS (mantida) -->
            <div class="content-section" id="solicitar-documentos-section">
    <h1 class="page-title">üìÑ Solicitar Documentos</h1>
    <p class="page-subtitle">Solicite documentos oficiais acad√™micos</p>

    <!-- BOT√ïES DE SOLICITA√á√ÉO -->
    <div class="cards-container" style="grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));">
        <!-- Hist√≥rico Escolar -->
        <div class="card">
            <div class="card-header" style="background: linear-gradient(135deg, var(--primary) 0%, #1e4b7c 100%);">
                <h3><i class="fas fa-history"></i> Hist√≥rico Escolar</h3>
                <div class="status-badge">Oficial</div>
            </div>
            <div class="card-content">
                <p style="color: var(--gray-600); margin-bottom: 20px; min-height: 60px;">
                    Solicite seu hist√≥rico escolar completo com todas as disciplinas cursadas, notas e carga hor√°ria.
                </p>
                <button class="btn btn-primary w-100 btn-solicitar-doc" 
                        data-tipo="historico" 
                        data-nome="Hist√≥rico Escolar"
                        onclick="abrirModalDocumentos('historico', 'Hist√≥rico Escolar')">
                    <i class="fas fa-file-pdf"></i> Solicitar Hist√≥rico
                </button>
            </div>
        </div>

        <!-- Declara√ß√£o de Conclus√£o -->
        <div class="card">
            <div class="card-header" style="background: linear-gradient(135deg, var(--success) 0%, #1b5e20 100%);">
                <h3><i class="fas fa-certificate"></i> Declara√ß√£o de Conclus√£o</h3>
                <div class="status-badge">Por Disciplina</div>
            </div>
            <div class="card-content">
                <p style="color: var(--gray-600); margin-bottom: 20px; min-height: 60px;">
                    Solicite declara√ß√£o de conclus√£o de disciplina(s) espec√≠fica(s) para comprova√ß√£o de estudos.
                </p>
                <button class="btn btn-success w-100 btn-solicitar-doc" 
                        data-tipo="conclusao" 
                        data-nome="Declara√ß√£o de Conclus√£o"
                        onclick="abrirModalDocumentos('conclusao', 'Declara√ß√£o de Conclus√£o')">
                    <i class="fas fa-file-signature"></i> Solicitar Declara√ß√£o
                </button>
            </div>
        </div>

        <!-- Plano de Ensino -->
        <div class="card">
            <div class="card-header" style="background: linear-gradient(135deg, var(--info) 0%, #01579b 100%);">
                <h3><i class="fas fa-book-open"></i> Plano de Ensino</h3>
                <div class="status-badge">Por Disciplina</div>
            </div>
            <div class="card-content">
                <p style="color: var(--gray-600); margin-bottom: 20px; min-height: 60px;">
                    Solicite o plano de ensino detalhado das disciplinas, contendo ementa, objetivos e bibliografia.
                </p>
                <button class="btn btn-primary w-100 btn-solicitar-doc" 
                        style="background: var(--info);" 
                        data-tipo="plano_ensino" 
                        data-nome="Plano de Ensino"
                        onclick="abrirModalDocumentos('plano_ensino', 'Plano de Ensino')">
                    <i class="fas fa-file-alt"></i> Solicitar Plano
                </button>
            </div>
        </div>

        <!-- Feedback/Sugest√£o -->
        <div class="card">
            <div class="card-header" style="background: linear-gradient(135deg, var(--warning) 0%, #b26a00 100%);">
                <h3><i class="fas fa-comment"></i> Feedback / Sugest√£o</h3>
                <div class="status-badge">Geral</div>
            </div>
            <div class="card-content">
                <p style="color: var(--gray-600); margin-bottom: 20px; min-height: 60px;">
                    Envie feedback, sugest√µes ou solicita√ß√µes espec√≠ficas para a coordena√ß√£o acad√™mica.
                </p>
                <button class="btn btn-warning w-100 btn-solicitar-doc" 
                        style="background: var(--warning); color: white;" 
                        data-tipo="sugestao" 
                        data-nome="Feedback/Sugest√£o"
                        onclick="abrirModalDocumentos('sugestao', 'Feedback/Sugest√£o')">
                    <i class="fas fa-paper-plane"></i> Enviar Feedback
                </button>
            </div>
        </div>

        <!-- Outros Documentos -->
        <div class="card">
            <div class="card-header" style="background: linear-gradient(135deg, var(--gray-600) 0%, var(--gray-800) 100%);">
                <h3><i class="fas fa-folder-open"></i> Outros Documentos</h3>
                <div class="status-badge">Espec√≠fico</div>
            </div>
            <div class="card-content">
                <p style="color: var(--gray-600); margin-bottom: 20px; min-height: 60px;">
                    Solicite outros tipos de documentos acad√™micos n√£o listados acima.
                </p>
                <button class="btn btn-secondary w-100 btn-solicitar-doc" 
                        data-tipo="outros" 
                        data-nome="Outros Documentos"
                        onclick="abrirModalDocumentos('outros', 'Outros Documentos')">
                    <i class="fas fa-file"></i> Solicitar Outros
                </button>
            </div>
        </div>
    </div>

    <!-- HIST√ìRICO DE SOLICITA√á√ïES -->
    <div style="margin-top: 40px;">
        <h2 class="section-title" style="margin-bottom: 20px;">
            <i class="fas fa-clock"></i> Minhas Solicita√ß√µes Recentes
        </h2>
        
        <div class="card" id="historicoSolicitacoes">
            <div style="text-align: center; padding: 30px;">
                <i class="fas fa-spinner fa-spin" style="font-size: 24px; color: var(--primary);"></i>
                <p>Carregando hist√≥rico...</p>
            </div>
        </div>
    </div>
</div>
        </main>
    </div>

    <!-- SCRIPT (mantido ID√äNTICO, apenas com pequenas corre√ß√µes de sintaxe) -->
<script>
    function toggleDisciplinaNotas(disciplinaId) {
        const content = document.getElementById('notas-' + disciplinaId);
        const icon = document.getElementById('icon-' + disciplinaId);
        if (content && icon) {
            content.classList.toggle('show');
            icon.classList.toggle('rotate-180');
        }
    }

    // Fun√ß√£o para mostrar popup de acesso
    function showAccessPopup(mensagem) {
        const modal = document.createElement('div');
        modal.style.cssText = `
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 10000;
        `;

        const modalContent = document.createElement('div');
        modalContent.style.cssText = `
            background: white;
            padding: 30px;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        `;

        modalContent.innerHTML = `
            <i class="fas fa-calendar-times" style="font-size: 48px; color: #ffc107; margin-bottom: 20px;"></i>
            <h3 style="color: var(--primary); margin-bottom: 15px;">Acesso Bloqueado</h3>
            <p style="color: var(--gray-700); margin-bottom: 25px; line-height: 1.6;">${mensagem}</p>
            <button id="closePopup" style="
                padding: 10px 25px;
                background: var(--primary);
                color: white;
                border: none;
                border-radius: 5px;
                cursor: pointer;
                font-size: 16px;
            ">Entendido</button>
        `;

        modal.appendChild(modalContent);
        document.body.appendChild(modal);

        modalContent.querySelector('#closePopup').addEventListener('click', function () {
            document.body.removeChild(modal);
        });

        modal.addEventListener('click', function (e) {
            if (e.target === modal) {
                document.body.removeChild(modal);
            }
        });
    }

    // Fun√ß√£o principal de navega√ß√£o
    window.showSection = function(sectionId) {
        const sections = document.querySelectorAll('.content-section');
        const menuItems = document.querySelectorAll('.section-menu-item');
        
        sections.forEach(section => section.classList.remove('active'));
        const targetSection = document.getElementById(sectionId + '-section');
        if (targetSection) {
            targetSection.classList.add('active');
            if (sectionId === 'meus-documentos') {
                carregarMeusDocumentos();
            }
        }
        
        menuItems.forEach(item => {
            item.classList.remove('active');
            if (item.getAttribute('data-section') === sectionId) {
                item.classList.add('active');
            }
        });
        
        localStorage.setItem('activeSection', sectionId);
    }

    // Carregar documentos
    function carregarMeusDocumentos() {
        fetch('/meus-documentos-api')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('documentos-recebidos');
                if (data.success && data.documentos.length > 0) {
                    let html = '<div class="documentos-grid">';
                    data.documentos.forEach(doc => {
                        const statusClass = doc.status === 'enviado' ? 'novo' : 'visualizado';
                        const statusText = doc.status === 'enviado' ? 'üì¨ Novo' : 'üëÅÔ∏è Visualizado';
                        
                        let icone = 'fa-file-alt';
                        if (doc.tipo === 'historico') icone = 'fa-history';
                        else if (doc.tipo === 'declaracao_conclusao') icone = 'fa-certificate';
                        else if (doc.tipo === 'plano_ensino') icone = 'fa-book';
                        
                        html += `
                            <div class="documento-card ${statusClass}">
                                <div class="documento-header">
                                    <i class="fas ${icone}"></i>
                                    <span class="status">${statusText}</span>
                                </div>
                                <h4>${doc.titulo}</h4>
                                ${doc.disciplina_nome ? `<p><small>${doc.disciplina_nome}</small></p>` : ''}
                                <p class="data">Enviado em: ${doc.data_envio}</p>
                                ${doc.mensagem ? `<p class="mensagem">üí¨ ${doc.mensagem}</p>` : ''}
                                <a href="/visualizar-documento/${doc.id}" class="btn-view" target="_blank">
                                    Visualizar Documento
                                </a>
                            </div>
                        `;
                    });
                    html += '</div>';
                    container.innerHTML = html;
                } else {
                    container.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-folder-open"></i>
                            <h3>Nenhum documento dispon√≠vel</h3>
                            <p>Voc√™ ainda n√£o recebeu nenhum documento oficial.</p>
                        </div>
                    `;
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                document.getElementById('documentos-recebidos').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-triangle" style="color: #dc3545;"></i>
                        <h3>Erro ao carregar documentos</h3>
                        <p>Tente novamente mais tarde.</p>
                    </div>
                `;
            });
    }

    // Fun√ß√µes para solicita√ß√£o de documentos
    function abrirModalDocumentos(tipo, nome) {
        fetch(`/solicitar-documentos-modal?tipo=${tipo}&nome=${encodeURIComponent(nome)}`)
            .then(response => response.text())
            .then(html => {
                document.getElementById('modalTitulo').textContent = `Solicitar ${nome}`;
                document.getElementById('modalConteudo').innerHTML = html;
                document.getElementById('modalDisciplinas').style.display = 'flex';
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao carregar modal');
            });
    }

    function fecharModal() {
        document.getElementById('modalDisciplinas').style.display = 'none';
        document.getElementById('modalConteudo').innerHTML = '';
    }

    function enviarSolicitacao() {
        const tipo = document.getElementById('docTipo').value;
        const nome = document.getElementById('docNome').value;
        const detalhes = document.getElementById('docDetalhes').value;
        const vias = document.getElementById('docVias').value;

        const checkboxes = document.querySelectorAll('.disciplina-checkbox:checked');
        const disciplinasIds = Array.from(checkboxes).map(cb => cb.value);

        if (disciplinasIds.length === 0) {
            alert('Selecione pelo menos uma disciplina!');
            return;
        }

        fetch('/solicitar-documento', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                tipo: tipo,
                nome: nome,
                disciplinas_ids: disciplinasIds,
                detalhes: detalhes,
                vias: vias
            })
        })
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                alert(data.message);
                fecharModal();
                carregarHistoricoDocumentos();
            } else {
                alert('Erro: ' + data.message);
            }
        })
        .catch(error => {
            console.error('Erro:', error);
            alert('Erro ao enviar solicita√ß√£o');
        });
    }

    function carregarHistoricoDocumentos() {
        fetch('/historico-documentos')
            .then(response => response.json())
            .then(data => {
                const container = document.getElementById('historicoSolicitacoes');
                if (data.success && data.solicitacoes.length > 0) {
                    let html = '<table class="requests-table"><thead><tr><th>Tipo</th><th>Disciplinas</th><th>Data</th><th>Status</th><th>A√ß√£o</th></tr></thead><tbody>';
                    
                    data.solicitacoes.forEach(s => {
                        const statusText = s.status === 'pendente' ? 'Pendente' : s.status === 'processando' ? 'Processando' : 'Conclu√≠do';
                        const statusClass = s.status === 'pendente' ? 'warning' : s.status === 'processando' ? 'info' : 'success';
                        
                        html += `
                            <tr>
                                <td>${getNomeDocumento(s.tipo_documento)}</td>
                                <td>${s.disciplinas_nomes || 'N/A'}</td>
                                <td>${s.data_solicitacao}</td>
                                <td><span class="badge-${statusClass}">${statusText}</span></td>
                                <td>
                                    ${s.arquivo_url ? 
                                        `<a href="${s.arquivo_url}" target="_blank" class="btn btn-primary" style="padding: 5px 10px;">Baixar</a>` : 
                                        '<span>Aguardando</span>'}
                                </td>
                            </tr>
                        `;
                    });
                    
                    html += '</tbody></table>';
                    container.innerHTML = html;
                } else {
                    container.innerHTML = '<div class="empty-state"><i class="fas fa-file-alt"></i><h3>Nenhuma solicita√ß√£o</h3><p>Voc√™ ainda n√£o fez nenhuma solicita√ß√£o.</p></div>';
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                document.getElementById('historicoSolicitacoes').innerHTML = '<div class="error-box"><p>Erro ao carregar hist√≥rico.</p></div>';
            });
    }

    function getNomeDocumento(tipo) {
        const nomes = {
            'conclusao': 'Declara√ß√£o de Conclus√£o',
            'plano_ensino': 'Plano de Ensino',
            'historico': 'Hist√≥rico Escolar',
            'sugestao': 'Feedback',
            'outros': 'Outros'
        };
        return nomes[tipo] || tipo;
    }

    // Verificar acesso a disciplina
    function verificarAntesDeAcessar(disciplinaId, callback) {
        fetch(`/verificar-conclusao/${disciplinaId}`)
            .then(response => response.json())
            .then(data => {
                if (data.concluida) {
                    if (data.status === 'concluida_com_final') {
                        showAccessPopup('Disciplina Conclu√≠da!');
                    } else if (data.status === 'aguardando_final') {
                        showAccessPopup('Cap√≠tulos Conclu√≠dos! Aguarde a prova final.');
                    }
                    return;
                } else {
                    fetch(`/verificar-acesso/${disciplinaId}`)
                        .then(response => response.json())
                        .then(acessoData => {
                            if (acessoData.acesso_permitido) {
                                callback();
                            } else {
                                showAccessPopup(acessoData.mensagem);
                            }
                        });
                }
            })
            .catch(error => {
                console.error('Erro:', error);
                callback();
            });
    }

    // Inicializa√ß√£o
    document.addEventListener('DOMContentLoaded', function () {
        const menuItems = document.querySelectorAll('.section-menu-item');
        
        menuItems.forEach(item => {
            item.addEventListener('click', function () {
                showSection(this.getAttribute('data-section'));
            });
        });

        const savedSection = localStorage.getItem('activeSection');
        showSection(savedSection || 'dashboard');

        // Observer para hist√≥rico de solicita√ß√µes
        const solicitacoesSection = document.getElementById('solicitar-documentos-section');
        if (solicitacoesSection) {
            const observer = new MutationObserver(function (mutations) {
                mutations.forEach(function (mutation) {
                    if (mutation.attributeName === 'class' && solicitacoesSection.classList.contains('active')) {
                        carregarHistoricoDocumentos();
                    }
                });
            });
            observer.observe(solicitacoesSection, { attributes: true });
        }

        // Event listeners para bot√µes de solicita√ß√£o
        document.querySelectorAll('.btn-solicitar-doc').forEach(button => {
            button.addEventListener('click', function () {
                const tipo = this.getAttribute('data-tipo');
                const nome = this.getAttribute('data-nome');
                abrirModalDocumentos(tipo, nome);
            });
        });

        // Abrir primeira disciplina na se√ß√£o de notas
        const primeiraDisciplina = document.querySelector('.disciplina-notas');
        if (primeiraDisciplina) {
            const onclick = primeiraDisciplina.querySelector('.disciplina-notas-header').getAttribute('onclick');
            if (onclick) {
                const match = onclick.match(/\d+/);
                if (match) toggleDisciplinaNotas(match[0]);
            }
        }
    });

    // Evento para bot√µes "Acessar"
    document.addEventListener('click', function (e) {
        const btnAcessar = e.target.closest('.btn-primary');
        if (btnAcessar && btnAcessar.closest('.card-actions')) {
            const href = btnAcessar.getAttribute('href');
            if (href && href.startsWith('/disciplina/')) {
                e.preventDefault();
                const disciplinaId = href.split('/')[2];
                verificarAntesDeAcessar(disciplinaId, function () {
                    window.location.href = href;
                });
            }
        }
    });
</script>

<div id="modalDisciplinas" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; align-items: center; justify-content: center; backdrop-filter: blur(4px);">
    <div style="background: white; border-radius: 16px; width: 90%; max-width: 600px; max-height: 80vh; overflow-y: auto; box-shadow: 0 20px 25px -5px rgba(0,0,0,0.3);">
        <div style="padding: 20px; border-bottom: 1px solid var(--gray-200); display: flex; justify-content: space-between; align-items: center;">
            <h3 id="modalTitulo" style="font-size: 1.25rem; color: var(--primary);">Solicitar Documento</h3>
            <button onclick="fecharModal()" style="background: none; border: none; font-size: 24px; cursor: pointer;">&times;</button>
        </div>
        <div id="modalConteudo" style="padding: 20px;">
            <!-- Conte√∫do carregado via AJAX -->
        </div>
        <div style="padding: 20px; border-top: 1px solid var(--gray-200); display: flex; justify-content: flex-end; gap: 10px;">
            <button onclick="fecharModal()" class="btn btn-secondary">Cancelar</button>
            <button onclick="enviarSolicitacao()" class="btn btn-primary">
                <i class="fas fa-paper-plane"></i> Enviar Solicita√ß√£o
            </button>
        </div>
    </div>
</div>
</body>

</html>